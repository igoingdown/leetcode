è¿™æ˜¯ä¸€é“**å…¸å‹çš„å¹¶å‘åç¨‹é¡ºåºæ§åˆ¶é¢˜**ï¼Œè¡¨é¢å¾ˆç®€å•ï¼Œå®é™…ä¸Šå¯ä»¥å¾ˆå¥½åœ°åŒºåˆ†å‡ºï¼š

* æ˜¯å¦çœŸæ­£ç†è§£ **goroutine çš„è°ƒåº¦ä¸ç¡®å®šæ€§**
* æ˜¯å¦æŒæ¡ **Go å¹¶å‘åŸè¯­çš„è®¾è®¡å“²å­¦**
* æ˜¯å¦èƒ½å†™å‡º **å¯æ¨å¹¿ã€å¯ç»´æŠ¤** çš„å¹¶å‘ä»£ç 

æˆ‘æŒ‰ä½ è¦æ±‚çš„ç»“æ„æ¥ï¼š**é¢˜æ„è§£æ â†’ æœ¬è´¨æŠ½è±¡ â†’ å¤šç§è§£æ³•ï¼ˆç”±æµ…åˆ°æ·±ï¼‰â†’ Golang å®ç° â†’ é¢è¯•è¯„ä»·**

---

# ä¸€ã€é¢˜æ„è§£æï¼ˆé€å­—æ‹†ï¼‰

> æœ‰ ABC ä¸‰ä¸ªåç¨‹ä¸€èµ·è·‘ï¼Œå¸Œæœ›è¾¾åˆ°è¿™æ ·çš„é¡ºåºè¾“å‡ºæ•ˆæœï¼š
> **A åç¨‹è¾“å‡º Aï¼ŒB åç¨‹è¾“å‡º Bï¼ŒC åç¨‹è¾“å‡º C**

### æ˜ç¤ºä¿¡æ¯

* å­˜åœ¨ **3 ä¸ª goroutine**
* å®ƒä»¬æ˜¯ **å¹¶å‘å¯åŠ¨çš„**
* è¾“å‡ºé¡ºåºå¿…é¡»æ˜¯ï¼š`A â†’ B â†’ C`

### éšå«ä½†å…³é”®çš„ä¿¡æ¯ï¼ˆé¢è¯•çœŸæ­£è€ƒçš„ï¼‰

1. goroutine **å¯åŠ¨é¡ºåº â‰  æ‰§è¡Œé¡ºåº**
2. è¾“å‡ºé¡ºåºå¿…é¡» **å¯æ§ã€ç¡®å®š**
3. ä¸èƒ½ä¾èµ–ï¼š

   * `sleep`
   * goroutine å¯åŠ¨å…ˆå
4. å¿…é¡»ç”¨ **å¹¶å‘åŒæ­¥æ‰‹æ®µ**

---

# äºŒã€æœ¬è´¨æŠ½è±¡ï¼ˆéå¸¸é‡è¦ï¼‰

è¿™é“é¢˜çš„æœ¬è´¨æ˜¯ï¼š

> **å¤šä¸ªå¹¶å‘æ‰§è¡Œå•å…ƒï¼Œåœ¨æ»¡è¶³æŸç§â€œå‰ç½®æ¡ä»¶â€åæ‰èƒ½ç»§ç»­æ‰§è¡Œ**

æŠ½è±¡æˆæ¨¡å‹ï¼š

```
A â†’ B â†’ C
```

å³ï¼š

* B å¿…é¡»ç­‰ A å®Œæˆ
* C å¿…é¡»ç­‰ B å®Œæˆ

è¿™æ˜¯ä¸€ä¸ª **é¡ºåºä¾èµ– / ä¿¡å·ä¼ é€’é—®é¢˜**

---

# ä¸‰ã€è§£æ³•ä¸€ï¼šchannel ä¸²è¡Œä¿¡å·ï¼ˆæœ€æ¨è / æœ€ Goï¼‰

### æ ¸å¿ƒæ€æƒ³

* ç”¨ **channel å½“ä¿¡å·**
* ä¸€ä¸ª goroutine å®Œæˆåï¼Œé€šçŸ¥ä¸‹ä¸€ä¸ª

### æŠ½è±¡

```
A --(signal1)--> B --(signal2)--> C
```

---

### Golang å®ç°

```go
package main

import (
	"fmt"
)

func main() {
	chAB := make(chan struct{})
	chBC := make(chan struct{})

	go func() {
		fmt.Print("A")
		close(chAB) // é€šçŸ¥ B
	}()

	go func() {
		<-chAB
		fmt.Print("B")
		close(chBC) // é€šçŸ¥ C
	}()

	go func() {
		<-chBC
		fmt.Print("C")
	}()

	// é˜»å¡ä¸» goroutine
	select {}
}
```

### ç‰¹ç‚¹åˆ†æ

* âœ… é¡ºåºä¸¥æ ¼
* âœ… æ—  busy wait
* âœ… ç¬¦åˆ Go çš„ CSP æ€æƒ³
* âŒ ç¨å¾®å•°å—¦ï¼ˆchannel å¤šï¼‰

ğŸ‘‰ **è¿™æ˜¯é¢è¯•å®˜æœ€å–œæ¬¢çœ‹åˆ°çš„è§£æ³•**

---

# å››ã€è§£æ³•äºŒï¼šWaitGroup + channelï¼ˆå±•ç¤ºç»„åˆèƒ½åŠ›ï¼‰

### æ€è·¯

* channel æ§åˆ¶é¡ºåº
* WaitGroup æ§åˆ¶ä¸» goroutine ç”Ÿå‘½å‘¨æœŸ

---

### å®ç°

```go
package main

import (
	"fmt"
	"sync"
)

func main() {
	var wg sync.WaitGroup
	wg.Add(3)

	chAB := make(chan struct{})
	chBC := make(chan struct{})

	go func() {
		defer wg.Done()
		fmt.Print("A")
		close(chAB)
	}()

	go func() {
		defer wg.Done()
		<-chAB
		fmt.Print("B")
		close(chBC)
	}()

	go func() {
		defer wg.Done()
		<-chBC
		fmt.Print("C")
	}()

	wg.Wait()
}
```

### è¯„ä»·

* âœ… å·¥ç¨‹æ„Ÿæ›´å¼º
* âœ… ä¸é  `select{}`
* âŒ å¯¹é¢˜ç›®æ¥è¯´ç•¥å¤æ‚

---

# äº”ã€è§£æ³•ä¸‰ï¼šä¸€ä¸ª channel + token ä¼ é€’ï¼ˆæŠ½è±¡èƒ½åŠ›åŠ åˆ†ï¼‰

### æ€è·¯

* ç”¨ä¸€ä¸ª channel ä¼ é€’â€œå½“å‰è½®åˆ°è°â€
* æ¯ä¸ª goroutine åªåœ¨â€œè½®åˆ°è‡ªå·±â€æ—¶è¾“å‡º

---

### å®ç°

```go
package main

import "fmt"

func main() {
	ch := make(chan string)

	go func() {
		if <-ch == "A" {
			fmt.Print("A")
			ch <- "B"
		}
	}()

	go func() {
		if <-ch == "B" {
			fmt.Print("B")
			ch <- "C"
		}
	}()

	go func() {
		if <-ch == "C" {
			fmt.Print("C")
		}
	}()

	// å¯åŠ¨ä¿¡å·
	ch <- "A"

	select {}
}
```

### è¯„ä»·

* âœ… æŠ½è±¡å±‚æ¬¡é«˜
* âœ… æ˜“æ¨å¹¿åˆ° N ä¸ª
* âŒ å¯¹åˆå­¦è€…ä¸ç›´è§‚

---

# å…­ã€è§£æ³•å››ï¼šsync.Condï¼ˆååº•å±‚ï¼Œé¢è¯•åŠ åˆ†ä½†ä¸æ¨èï¼‰

### æ€è·¯

* æ¡ä»¶å˜é‡
* ä¸€ä¸ªå…±äº«çŠ¶æ€è¡¨ç¤ºâ€œè½®åˆ°è°â€

---

### å®ç°

```go
package main

import (
	"fmt"
	"sync"
)

func main() {
	var mu sync.Mutex
	cond := sync.NewCond(&mu)
	state := 0 // 0:A, 1:B, 2:C

	go func() {
		mu.Lock()
		for state != 0 {
			cond.Wait()
		}
		fmt.Print("A")
		state = 1
		cond.Broadcast()
		mu.Unlock()
	}()

	go func() {
		mu.Lock()
		for state != 1 {
			cond.Wait()
		}
		fmt.Print("B")
		state = 2
		cond.Broadcast()
		mu.Unlock()
	}()

	go func() {
		mu.Lock()
		for state != 2 {
			cond.Wait()
		}
		fmt.Print("C")
		mu.Unlock()
	}()

	select {}
}
```

### è¯„ä»·

* âœ… ç†è®ºåŠŸåº•å¼º
* âŒ ä¸ç¬¦åˆ Go çš„æ¨èå¹¶å‘é£æ ¼
* âŒ å†™é”™æ¦‚ç‡é«˜

---

# ä¸ƒã€å¸¸è§é”™è¯¯ï¼ˆé¢è¯•ç›´æ¥æŒ‚ï¼‰

âŒ ç”¨ `time.Sleep` æ§åˆ¶é¡ºåº
âŒ ä¾èµ– goroutine å¯åŠ¨é¡ºåº
âŒ ç”¨å…±äº«å˜é‡ä½†ä¸åŠ åŒæ­¥
âŒ å¿½ç•¥ main goroutine é€€å‡ºé—®é¢˜

---

# å…«ã€å¦‚ä½•ä¸€å¥è¯â€œæ‹”é«˜â€è¿™é“é¢˜ï¼ˆé¢è¯•å¿…æ€ï¼‰

ä½ å¯ä»¥è¿™æ ·æ€»ç»“ï¼š

> è¿™é“é¢˜æœ¬è´¨æ˜¯ **å¹¶å‘åç¨‹çš„é¡ºåºä¾èµ–æ§åˆ¶é—®é¢˜**ï¼Œ
> åœ¨ Go é‡Œæœ€è‡ªç„¶çš„è§£æ³•æ˜¯ **ç”¨ channel ä½œä¸ºä¿¡å·è¿›è¡Œé˜¶æ®µä¸²è”**ï¼Œ
> è€Œä¸æ˜¯ç”¨é”æˆ– sleep å»â€œç¢°è¿æ°”â€ã€‚

---

# ä¹ã€è¿½é—®å»¶å±•ï¼ˆé¢è¯•å®˜å¾ˆå¯èƒ½ç»§ç»­ï¼‰

1. å¦‚ä½•æ‰©å±•åˆ° **ABC å¾ªç¯æ‰“å° 10 æ¬¡**ï¼Ÿ
2. å¦‚ä½•æ‰©å±•åˆ° **N ä¸ª goroutine**ï¼Ÿ
3. å¦‚ä½•æ”¯æŒ **åŠ¨æ€æ³¨å†Œçš„ goroutine**ï¼Ÿ
4. å¦‚æœè¾“å‡ºé€»è¾‘å¯èƒ½ panicï¼Œæ€ä¹ˆä¿è¯ä¸æ­»é”ï¼Ÿ


